# PART 1 Virtualization
## 17

### sbrk系统调用

用于管理进程的数据段（heap）的大小。它允许程序增加或减少其数据段的大小，从而动态地分配和释放内存。

**不是线程安全的**

```c
void *sbrk(intptr_t increment);
```

## 19

### 全相联和组相联

在计算机体系结构中，全相联（Fully Associative）和组相联（Set Associative）是两种常见的缓存组织方式。它们定义了如何在缓存中查找和存储数据，以提高缓存命中率和整体系统性能。以下是详细介绍：

### 全相联缓存（Fully Associative Cache）

#### 概念
- **全相联缓存**是一种缓存组织方式，其中每个缓存块可以存放在缓存的任何位置。
- **查找机制**：在全相联缓存中，数据块可以存放在缓存中的任何一个位置。因此，查找数据时，需要比较缓存中所有块的标记（tag）。

#### 优点
- **高灵活性**：由于数据可以存放在任何位置，缓存命中率较高。
- **冲突少**：缓存冲突（cache collision）几率低，因为每个块有更多的选择。

#### 缺点
- **高成本**：需要更多硬件支持并行比较多个标记，成本较高。
- **查找时间长**：需要并行检查所有缓存块，查找时间较长。

#### 示例
假设有一个全相联缓存，容量为4个块，标签分别为A、B、C、D。任意新数据块可以放置在任意空闲位置或替换现有的数据块。

### 组相联缓存（Set Associative Cache）

#### 概念
- **组相联缓存**是一种介于直接映射缓存（Direct Mapped Cache）和全相联缓存之间的折中方案。缓存被分成多个组（sets），每个组包含若干个缓存块。
- **查找机制**：数据首先根据地址映射到特定的组，然后在该组内进行全相联查找。

#### 分类
- **n-路组相联缓存（n-way Set Associative Cache）**：每个组包含n个缓存块。例如，2-路组相联缓存意味着每个组有2个缓存块。

#### 优点
- **折中方案**：相比全相联缓存，减少了硬件复杂度和成本；相比直接映射缓存，提高了缓存命中率。
- **查找速度较快**：相比全相联缓存，查找范围缩小到特定的组，查找速度较快。

#### 缺点
- **仍有冲突**：相比全相联缓存，缓存冲突几率稍高。

#### 示例
假设有一个2-路组相联缓存，容量为4个块，分成2个组，每个组包含2个块。数据块首先根据地址映射到其中一个组，然后在该组内的2个块中进行查找和替换。

### 比较

- **灵活性**：
  - 全相联缓存最灵活，组相联缓存次之，直接映射缓存最不灵活。
  
- **成本和复杂性**：
  - 全相联缓存成本最高，组相联缓存次之，直接映射缓存成本最低。

- **缓存冲突**：
  - 全相联缓存冲突最少，组相联缓存次之，直接映射缓存冲突最多。

### 总结

全相联和组相联是缓存组织的两种不同方式，前者提供最大的灵活性和最低的冲突率，但成本和复杂性最高；后者则在灵活性、成本和复杂性之间取得了平衡。根据系统性能需求和硬件资源，可以选择合适的缓存组织方式。
